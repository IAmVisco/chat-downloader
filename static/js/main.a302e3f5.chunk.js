(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{36:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(12),s=n.n(r),o=n(6),i=n.n(o),l=n(8),u=n(7),d=n(2),j=n(21),h=n.n(j),b=n(40),x=n(41),O=n(22),m=n(46),f=n(42),p=n(43),v=n(45),g=n(44),y=n(26),k=n(1),w=2e3,S=h()(window.fetch),C="https://chat-api.iamvis.co",I=function(e,t,n){switch(t){case"youtube.com":case"youtu.be":case"www.youtube.com":return"https://youtu.be/".concat(n,"?t=").concat(e.time>0?e.time.toFixed(0):0);case"twitch.tv":return"https://twitch.tv/videos/".concat(n,"?t=").concat(e.time>0?e.time.toFixed(0):0,"s");default:return""}},L=function(){var e=JSON.parse(localStorage.getItem("cachedFormData")||"{}"),t=Object(y.a)({defaultValues:Object(d.a)({scOnly:!0},e)}),n=t.register,c=t.handleSubmit,r=Object(a.useState)(""),s=Object(u.a)(r,2),o=s[0],j=s[1],h=Object(a.useState)({}),L=Object(u.a)(h,2),N=L[0],E=N.taskId,D=N.videoId,F=N.host,R=L[1],T=Object(a.useState)(null),J=Object(u.a)(T,2),U=J[0],A=J[1],M=Object(a.useState)(!1),B=Object(u.a)(M,2),G=B[0],P=B[1],V=Object(a.useState)(null),_=Object(u.a)(V,2),q=_[0],z=_[1],X=Object(a.useState)([]),Y=Object(u.a)(X,2),H=Y[0],K=Y[1],Q=Object(a.useState)(!1),W=Object(u.a)(Q,2),Z=W[0],$=W[1];Object(a.useEffect)((function(){fetch(C).catch((function(){return A("\u26a0 Backend unavailable \u26a0")}))}),[]),Object(a.useEffect)((function(){var e=new RegExp(o,"i"),t=null===q||void 0===q?void 0:q.filter((function(t){return o?t.message&&t.message.match(e)||t.author&&t.author.match(e):t}));K(t||[])}),[q,o]);var ee=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,a,c,r,s,o,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A(null),R({}),z(null),P(!0),$(!1),n=JSON.stringify(t),localStorage.setItem("cachedFormData",n),e.prev=7,e.next=10,fetch("".concat(C,"/chat"),{method:"POST",headers:{"Content-Type":"application/json"},body:n});case 10:if((a=e.sent).ok){e.next=16;break}return e.next=14,a.json();case 14:throw c=e.sent,new Error(null===c||void 0===c?void 0:c.message);case 16:return e.next=18,a.json();case 18:r=e.sent,s=r.id,o=r.videoId,u=r.host,R({taskId:s,videoId:o,host:u}),S("".concat(C,"/chat/status/").concat(s),{retryOn:function(){var e=Object(l.a)(i.a.mark((function e(t,n,a){var c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===a||void 0===a?void 0:a.json();case 2:if(e.t1=c=e.sent,e.t0=null===e.t1,e.t0){e.next=6;break}e.t0=void 0===c;case 6:if(!e.t0){e.next=10;break}e.t2=void 0,e.next=11;break;case 10:e.t2=c.state;case 11:return e.t3=e.t2,e.abrupt("return","SENT"===e.t3);case 13:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),retryDelay:2e3}).then(Object(l.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(C,"/chat/").concat(s));case 2:if(t=e.sent,P(!1),!t.ok){e.next=12;break}return e.t0=z,e.next=8,t.json();case 8:e.t1=e.sent,(0,e.t0)(e.t1),e.next=16;break;case 12:return e.next=14,t.json();case 14:n=e.sent,A(null===n||void 0===n?void 0:n.message);case 16:case"end":return e.stop()}}),e)})))),e.next=30;break;case 26:e.prev=26,e.t0=e.catch(7),A(e.t0.message),P(!1);case 30:case"end":return e.stop()}}),e,null,[[7,26]])})));return function(t){return e.apply(this,arguments)}}(),te=function(){var e=Object(l.a)(i.a.mark((function e(){var t,n,a,c,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(C,"/chat/").concat(E,"/csv"));case 2:if(!(t=e.sent).ok){e.next=18;break}return e.next=6,t.blob();case 6:n=e.sent,a=URL.createObjectURL(n),(c=document.createElement("a")).style.display="none",c.href=a,c.download="".concat(E,".csv"),document.body.appendChild(c),c.click(),URL.revokeObjectURL(a),c.remove(),e.next=22;break;case 18:return e.next=20,t.json();case 20:r=e.sent,A(null===r||void 0===r?void 0:r.message);case 22:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(k.jsxs)(b.a,{fluid:"xl",style:{overflowX:"auto"},children:[Object(k.jsx)(x.a,{children:Object(k.jsxs)(O.a,{children:[Object(k.jsx)("h1",{children:"Chat Downloader"}),Object(k.jsx)("hr",{})]})}),Object(k.jsx)(m.a,{className:"pb-1 px-2",onSubmit:c(ee),children:Object(k.jsxs)(m.a.Group,{as:x.a,controlId:"formSearch",children:[Object(k.jsx)(O.a,{children:Object(k.jsx)(m.a.Control,Object(d.a)({type:"search",className:"mx-0",required:!0,tabIndex:1,placeholder:"YouTube Link"},n("url")))}),Object(k.jsx)(f.a,{variant:"primary",type:"submit",className:"col-3",tabIndex:3,disabled:G,children:G?Object(k.jsx)(p.a,{animation:"border",size:"sm"}):"Load"}),Object(k.jsx)(m.a.Group,{as:x.a,className:"my-3",children:Object(k.jsx)(O.a,{children:Object(k.jsx)(m.a.Check,Object(d.a)({type:"checkbox",label:"Super Chats only",tabIndex:2},n("scOnly")))})})]})}),U&&Object(k.jsx)(v.a,{variant:"danger",dismissible:!0,onClose:function(){return A("")},children:U}),q?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsxs)(x.a,{className:"pb-3",children:[Object(k.jsxs)(O.a,{md:4,children:[Object(k.jsx)("h3",{children:"Chat messages"}),q.length?Object(k.jsxs)("small",{children:[o?"Showing":"Loaded"," ",H.length," messages.",q.length>w&&!Z&&" Preview for more than ".concat(w," messages is disabled by default. "),q.length>w&&!Z&&Object(k.jsx)("a",{href:"#",onClick:function(){return $(!0)},children:"Load anyway"})]}):Object(k.jsxs)("small",{children:["Loaded ",q.length," messages. Maybe try different filters?"]})]}),Object(k.jsx)(O.a,{md:4,children:Object(k.jsx)(m.a.Control,{type:"search",className:"mb-4",placeholder:"Search author or message...",value:o,onChange:function(e){return j(e.target.value)}})}),Object(k.jsx)(O.a,{md:4,style:{textAlign:"right"},children:Object(k.jsx)(f.a,{variant:"success",onClick:te,children:"Download CSV"})})]}),(q.length>w&&Z||q.length<w)&&Object(k.jsxs)(g.a,{variant:"dark",hover:!0,children:[Object(k.jsx)("thead",{children:Object(k.jsxs)("tr",{children:[Object(k.jsx)("th",{children:"Time"}),Object(k.jsx)("th",{children:"Amount"}),Object(k.jsx)("th",{children:"Author"}),Object(k.jsx)("th",{children:"Message"})]})}),Object(k.jsx)("tbody",{children:H.map((function(e){return Object(k.jsxs)("tr",{children:[Object(k.jsx)("td",{children:Object(k.jsx)("a",{href:I(e,F,D),target:"_blank",rel:"noreferrer",children:e.time_text})}),Object(k.jsx)("td",{children:e.amount||"-"}),Object(k.jsx)("td",{children:e.author}),Object(k.jsx)("td",{children:e.message||""})]})}))})]})]}):null]})};n(36);s.a.render(Object(k.jsx)(c.a.StrictMode,{children:Object(k.jsx)(L,{})}),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.a302e3f5.chunk.js.map