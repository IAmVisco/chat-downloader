{"version":3,"sources":["App.tsx","index.tsx"],"names":["fetchRetry","fetchBuilder","window","fetch","backendUrl","process","REACT_APP_BACKEND_URL","App","formData","JSON","parse","localStorage","getItem","useForm","defaultValues","scOnly","register","handleSubmit","useState","filter","setFilter","taskId","videoId","setTaskData","error","setError","fetching","setFetching","scData","setScData","useEffect","catch","submitForm","data","a","body","stringify","setItem","method","headers","response","ok","json","Error","message","id","retryOn","_","__","res","state","retryDelay","then","downloadCSV","blob","url","URL","createObjectURL","document","createElement","style","display","href","download","appendChild","click","revokeObjectURL","remove","Container","fluid","Row","Col","Form","className","onSubmit","Group","as","controlId","Control","type","required","tabIndex","placeholder","Button","variant","disabled","Spinner","animation","size","Check","label","Alert","dismissible","onClose","md","length","sc","match","RegExp","value","onChange","e","target","textAlign","onClick","Table","hover","map","i","time","toFixed","time_text","amount","author","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.6f2ea946.chunk.js","sourcesContent":["import fetchBuilder from 'fetch-retry';\nimport React, { useEffect, useState } from 'react';\nimport { Alert, Button, Col, Container, Form, Row, Spinner, Table } from 'react-bootstrap';\nimport { SubmitHandler, useForm } from 'react-hook-form';\n\nconst fetchRetry = fetchBuilder(window.fetch);\nconst backendUrl = process.env.REACT_APP_BACKEND_URL || 'http://localhost:5000';\n\ninterface SuperChat {\n  time: number;\n  time_text: string;\n  amount: string;\n  author: string | null;\n  message: string | null;\n}\n\ntype FormData = {\n  url: string;\n  scOnly: boolean;\n}\n\nexport const App = () => {\n  const formData = JSON.parse(localStorage.getItem('cachedFormData') || '{}');\n  const { register, handleSubmit } = useForm<FormData>({ defaultValues: { scOnly: true, ...formData } });\n  const [filter, setFilter] = useState('');\n  const [{ taskId, videoId }, setTaskData] = useState<{ taskId?: string, videoId?: string }>({});\n  const [error, setError] = useState<string | null>(null);\n  const [fetching, setFetching] = useState(false);\n  const [scData, setScData] = useState<SuperChat[] | null>(null);\n\n  useEffect(() => {\n    fetch(backendUrl).catch(() => setError('⚠ Backend unavailable ⚠'));\n  }, []);\n\n  const submitForm: SubmitHandler<FormData> = async (data) => {\n    setError(null);\n    setTaskData({});\n    setScData(null);\n    setFetching(true);\n    const body = JSON.stringify(data);\n    localStorage.setItem('cachedFormData', body);\n\n    try {\n      const response = await fetch(`${backendUrl}/chat`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error?.message);\n      }\n\n      const { id: taskId, videoId } = await response.json();\n      setTaskData({ taskId, videoId });\n      fetchRetry(`${backendUrl}/chat/status/${taskId}`, {\n        retryOn: async (_, __, res) => (await res?.json())?.state === 'SENT',\n        retryDelay: 2000,\n      }).then(async () => {\n        const response = await fetch(`${backendUrl}/chat/${taskId}`);\n        setFetching(false);\n        if (response.ok) setScData(await response.json());\n        else {\n          const error = await response.json();\n          setError(error?.message);\n        }\n      });\n    } catch (e) {\n      setError(e.message);\n      setFetching(false);\n    }\n  };\n\n  const downloadCSV = async () => {\n    const response = await fetch(`${backendUrl}/chat/${taskId}/csv`);\n    if (response.ok) {\n      const blob = await response.blob();\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.style.display = 'none';\n      a.href = url;\n      a.download = `${taskId}.csv`;\n      document.body.appendChild(a);\n      a.click();\n      URL.revokeObjectURL(url);\n      a.remove();\n    } else {\n      const error = await response.json();\n      setError(error?.message);\n    }\n  };\n\n  return (\n    <Container fluid=\"xl\">\n      <Row>\n        <Col>\n          <h1>Chat Downloader</h1>\n          <hr />\n        </Col>\n      </Row>\n      <Form className=\"pb-1 px-2\" onSubmit={handleSubmit(submitForm)}>\n        <Form.Group as={Row} controlId=\"formSearch\">\n          <Col>\n            <Form.Control\n              type=\"search\" className=\"mx-0\" required tabIndex={1} placeholder=\"YouTube Link\" {...register('url')} />\n          </Col>\n          <Button variant=\"primary\" type=\"submit\" className=\"col-3\" tabIndex={3} disabled={fetching}>\n            {fetching ? (<Spinner animation=\"border\" size=\"sm\" />) : 'Load'}\n          </Button>\n          <Form.Group as={Row} className=\"my-3\">\n            <Col>\n              <Form.Check\n                type=\"checkbox\" label=\"Super Chats only\" tabIndex={2} {...register('scOnly')} />\n            </Col>\n          </Form.Group>\n        </Form.Group>\n      </Form>\n\n      {error && <Alert variant=\"danger\" dismissible onClose={() => setError('')}>{error}</Alert>}\n\n      {scData ?\n        <>\n          <Row className=\"pb-3\">\n            <Col md={4}>\n              <h3>Chat messages</h3>\n              {scData.length\n                ? <small>{filter ? 'Showing' : 'Loading'} {\n                  scData.filter(sc => filter ? sc.message && sc.message.match(new RegExp(filter, 'i')) : sc).length\n                } messages.</small>\n                : <small>Loaded {scData.length} messages. Maybe try different filters?</small>\n              }\n            </Col>\n            <Col md={4}>\n              <Form.Control type=\"search\" className=\"mb-4\" placeholder=\"Search message...\" value={filter}\n                            onChange={(e) => setFilter(e.target.value)} />\n            </Col>\n            <Col md={4} style={{ textAlign: 'right' }}>\n              <Button variant=\"success\" onClick={downloadCSV}>Download CSV</Button>\n            </Col>\n          </Row>\n          <Table variant=\"dark\" hover>\n            <thead>\n            <tr>\n              <th>Time</th>\n              <th>Amount</th>\n              <th>Author</th>\n              <th>Message</th>\n            </tr>\n            </thead>\n            <tbody>\n            {scData\n              .filter(sc => filter ? sc.message && sc.message.match(new RegExp(filter, 'i')) : sc)\n              .map((sc, i) => (\n                <tr key={i}>\n                  <td><a\n                    href={`https://youtu.be/${videoId}?t=${sc.time > 0 ? sc.time.toFixed(0) : 0}`}>{sc.time_text}</a>\n                  </td>\n                  <td>{sc.amount || '-'}</td>\n                  <td>{sc.author}</td>\n                  <td>{sc.message || ''}</td>\n                </tr>\n              ))}\n            </tbody>\n          </Table>\n        </>\n        : null}\n    </Container>\n  );\n};\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { App } from './App';\nimport './index.scss';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root'),\n);\n"],"sourceRoot":""}