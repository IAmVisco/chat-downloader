(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{36:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(12),s=n.n(r),o=n(5),i=n.n(o),l=n(8),d=n(7),j=n(2),u=n(21),h=n.n(u),b=n(40),x=n(41),O=n(22),m=n(46),f=n(42),p=n(43),v=n(45),g=n(44),k=n(26),y=n(1),w=h()(window.fetch),S="https://chat-api.iamvis.co",C=function(){var e=JSON.parse(localStorage.getItem("cachedFormData")||"{}"),t=Object(k.a)({defaultValues:Object(j.a)({scOnly:!0},e)}),n=t.register,c=t.handleSubmit,r=Object(a.useState)(""),s=Object(d.a)(r,2),o=s[0],u=s[1],h=Object(a.useState)({}),C=Object(d.a)(h,2),I=C[0],N=I.taskId,L=I.videoId,E=C[1],D=Object(a.useState)(null),R=Object(d.a)(D,2),T=R[0],F=R[1],J=Object(a.useState)(!1),U=Object(d.a)(J,2),A=U[0],M=U[1],B=Object(a.useState)(null),G=Object(d.a)(B,2),V=G[0],q=G[1],z=Object(a.useState)([]),P=Object(d.a)(z,2),X=P[0],Y=P[1];Object(a.useEffect)((function(){fetch(S).catch((function(){return F("\u26a0 Backend unavailable \u26a0")}))}),[]),Object(a.useEffect)((function(){var e=new RegExp(o,"i"),t=null===V||void 0===V?void 0:V.filter((function(t){return o?t.message&&t.message.match(e)||t.author&&t.author.match(e):t}));Y(t||[])}),[V,o]);var _=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,a,c,r,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F(null),E({}),q(null),M(!0),n=JSON.stringify(t),localStorage.setItem("cachedFormData",n),e.prev=6,e.next=9,fetch("".concat(S,"/chat"),{method:"POST",headers:{"Content-Type":"application/json"},body:n});case 9:if((a=e.sent).ok){e.next=15;break}return e.next=13,a.json();case 13:throw c=e.sent,new Error(null===c||void 0===c?void 0:c.message);case 15:return e.next=17,a.json();case 17:r=e.sent,s=r.id,o=r.videoId,E({taskId:s,videoId:o}),w("".concat(S,"/chat/status/").concat(s),{retryOn:function(){var e=Object(l.a)(i.a.mark((function e(t,n,a){var c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===a||void 0===a?void 0:a.json();case 2:if(e.t1=c=e.sent,e.t0=null===e.t1,e.t0){e.next=6;break}e.t0=void 0===c;case 6:if(!e.t0){e.next=10;break}e.t2=void 0,e.next=11;break;case 10:e.t2=c.state;case 11:return e.t3=e.t2,e.abrupt("return","SENT"===e.t3);case 13:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),retryDelay:2e3}).then(Object(l.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(S,"/chat/").concat(s));case 2:if(t=e.sent,M(!1),!t.ok){e.next=12;break}return e.t0=q,e.next=8,t.json();case 8:e.t1=e.sent,(0,e.t0)(e.t1),e.next=16;break;case 12:return e.next=14,t.json();case 14:n=e.sent,F(null===n||void 0===n?void 0:n.message);case 16:case"end":return e.stop()}}),e)})))),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(6),F(e.t0.message),M(!1);case 28:case"end":return e.stop()}}),e,null,[[6,24]])})));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=Object(l.a)(i.a.mark((function e(){var t,n,a,c,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(S,"/chat/").concat(N,"/csv"));case 2:if(!(t=e.sent).ok){e.next=18;break}return e.next=6,t.blob();case 6:n=e.sent,a=URL.createObjectURL(n),(c=document.createElement("a")).style.display="none",c.href=a,c.download="".concat(N,".csv"),document.body.appendChild(c),c.click(),URL.revokeObjectURL(a),c.remove(),e.next=22;break;case 18:return e.next=20,t.json();case 20:r=e.sent,F(null===r||void 0===r?void 0:r.message);case 22:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(y.jsxs)(b.a,{fluid:"xl",style:{overflowX:"auto"},children:[Object(y.jsx)(x.a,{children:Object(y.jsxs)(O.a,{children:[Object(y.jsx)("h1",{children:"Chat Downloader"}),Object(y.jsx)("hr",{})]})}),Object(y.jsx)(m.a,{className:"pb-1 px-2",onSubmit:c(_),children:Object(y.jsxs)(m.a.Group,{as:x.a,controlId:"formSearch",children:[Object(y.jsx)(O.a,{children:Object(y.jsx)(m.a.Control,Object(j.a)({type:"search",className:"mx-0",required:!0,tabIndex:1,placeholder:"YouTube Link"},n("url")))}),Object(y.jsx)(f.a,{variant:"primary",type:"submit",className:"col-3",tabIndex:3,disabled:A,children:A?Object(y.jsx)(p.a,{animation:"border",size:"sm"}):"Load"}),Object(y.jsx)(m.a.Group,{as:x.a,className:"my-3",children:Object(y.jsx)(O.a,{children:Object(y.jsx)(m.a.Check,Object(j.a)({type:"checkbox",label:"Super Chats only",tabIndex:2},n("scOnly")))})})]})}),T&&Object(y.jsx)(v.a,{variant:"danger",dismissible:!0,onClose:function(){return F("")},children:T}),V?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)(x.a,{className:"pb-3",children:[Object(y.jsxs)(O.a,{md:4,children:[Object(y.jsx)("h3",{children:"Chat messages"}),V.length?Object(y.jsxs)("small",{children:[o?"Showing":"Loading"," ",X.length," messages."]}):Object(y.jsxs)("small",{children:["Loaded ",V.length," messages. Maybe try different filters?"]})]}),Object(y.jsx)(O.a,{md:4,children:Object(y.jsx)(m.a.Control,{type:"search",className:"mb-4",placeholder:"Search author or message...",value:o,onChange:function(e){return u(e.target.value)}})}),Object(y.jsx)(O.a,{md:4,style:{textAlign:"right"},children:Object(y.jsx)(f.a,{variant:"success",onClick:H,children:"Download CSV"})})]}),Object(y.jsxs)(g.a,{variant:"dark",hover:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Time"}),Object(y.jsx)("th",{children:"Amount"}),Object(y.jsx)("th",{children:"Author"}),Object(y.jsx)("th",{children:"Message"})]})}),Object(y.jsx)("tbody",{children:X.map((function(e,t){return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:Object(y.jsx)("a",{href:"https://youtu.be/".concat(L,"?t=").concat(e.time>0?e.time.toFixed(0):0),children:e.time_text})}),Object(y.jsx)("td",{children:e.amount||"-"}),Object(y.jsx)("td",{children:e.author}),Object(y.jsx)("td",{children:e.message||""})]},t)}))})]})]}):null]})};n(36);s.a.render(Object(y.jsx)(c.a.StrictMode,{children:Object(y.jsx)(C,{})}),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.0fa8d70b.chunk.js.map